#autoload
portable:osc7_cwd() {
  emulate -L zsh

  # Only bother in interactive shells
  [[ -o interactive ]] || return 0

  # Allow opt-out or skip for very minimal terminals
  [[ -n ${OSC7_DISABLE:-} ]] && return 0
  [[ $TERM == (dumb|linux) ]] && return 0

  local host path url_path
  host=${OSC7_HOST:-$HOST}
  path=$PWD

  # Very small, cheap URL-style escaping for common cases: encode spaces
  # and literal '#' characters inside the path.
  url_path=${path// /%20}

  # OSC 7: report current working directory as a canonical file:// URL.
  # Use ST (ESC \) terminator for compatibility with most terminals.
  printf '\033]7;file://%s%s\033\\' "$host" "$url_path"
}

#  vim: set ft=zsh ts=2 sw=2 tw=0 et :
